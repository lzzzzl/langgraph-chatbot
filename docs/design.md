# å®ç°æ€è·¯

## ä¸€ã€æ ¸å¿ƒæ¶æ„è®¾è®¡

LangGraph Chatbot çš„æ ¸å¿ƒç†å¿µï¼š

- çŠ¶æ€å›¾ï¼ˆState Graphï¼‰ï¼šå°†å¯¹è¯æµç¨‹å»ºæ¨¡ä¸ºçŠ¶æ€æœºï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå¤„ç†æ­¥éª¤
- å¯ç»„åˆæ€§ï¼šé€šè¿‡èŠ‚ç‚¹ç»„åˆå®ç°å¤æ‚çš„å¯¹è¯é€»è¾‘
- å¯è§‚å¯Ÿæ€§ï¼šæ¯ä¸ªçŠ¶æ€è½¬æ¢éƒ½å¯è¿½è¸ªå’Œè°ƒè¯•
- æŒä¹…åŒ–ï¼šæ”¯æŒå¯¹è¯çŠ¶æ€çš„ä¿å­˜å’Œæ¢å¤

## äºŒã€å…³é”®ç»„ä»¶

1. å›¾ç»“æ„ï¼ˆGraphï¼‰

- å…¥å£èŠ‚ç‚¹ï¼šæ¥æ”¶ç”¨æˆ·è¾“å…¥
- æ„å›¾åˆ†ç±»èŠ‚ç‚¹ï¼šç†è§£ç”¨æˆ·æ„å›¾
- å·¥å…·è°ƒç”¨èŠ‚ç‚¹ï¼šæ‰§è¡Œå…·ä½“æ“ä½œ
- å“åº”ç”ŸæˆèŠ‚ç‚¹ï¼šç”Ÿæˆå›å¤
- æ¡ä»¶è·¯ç”±èŠ‚ç‚¹ï¼šæ ¹æ®çŠ¶æ€å†³å®šä¸‹ä¸€æ­¥

2. çŠ¶æ€ç®¡ç†ï¼ˆStateï¼‰

- æ¶ˆæ¯å†å²
- ç”¨æˆ·ä¸Šä¸‹æ–‡
- ä¼šè¯å…ƒæ•°æ®
- ä¸­é—´ç»“æœ

3. å·¥å…·é›†æˆï¼ˆToolsï¼‰

- æœç´¢å·¥å…·
- æ•°æ®åº“æŸ¥è¯¢
- API è°ƒç”¨
- è‡ªå®šä¹‰åŠŸèƒ½

## ä¸‰ã€ç›®å½•ç»“æ„

```
langgraph-chatbot/
â”œâ”€â”€ README.md                        # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ requirements.txt                 # Python ä¾èµ–åŒ…
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore                       # Git å¿½ç•¥é…ç½®
â”œâ”€â”€ pyproject.toml                   # é¡¹ç›®é…ç½®ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ Makefile                         # å¸¸ç”¨å‘½ä»¤å¿«æ·æ–¹å¼
â”‚
â”œâ”€â”€ config/                          # ğŸ“ é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py                 # å…¨å±€é…ç½®ï¼ˆLLMã€Redisã€DB ç­‰ï¼‰
â”‚   â””â”€â”€ prompts.py                  # æç¤ºè¯æ¨¡æ¿åº“
â”‚
â”œâ”€â”€ src/                            # ğŸ’» æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                        # ğŸŒ API æ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ app.py                 # FastAPI åº”ç”¨ä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ routes/                # è·¯ç”±æ¨¡å—åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py           # å¯¹è¯ç›¸å…³è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ session.py        # ä¼šè¯ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ tools.py          # å·¥å…·ç›¸å…³è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ admin.py          # ç®¡ç†æ¥å£è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ schemas.py             # Pydantic æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ dependencies.py        # ä¾èµ–æ³¨å…¥
â”‚   â”‚   â”œâ”€â”€ middleware.py          # ä¸­é—´ä»¶ï¼ˆè®¤è¯ã€æ—¥å¿—ã€CORSï¼‰
â”‚   â”‚   â””â”€â”€ exceptions.py          # è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                   # ğŸ”§ ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ chatbot_service.py    # Chatbot æ ¸å¿ƒæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ session_manager.py    # ä¼šè¯ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ auth_service.py       # ç”¨æˆ·è®¤è¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ metrics_service.py    # ç›‘æ§æŒ‡æ ‡æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ graph/                      # ğŸ”„ LangGraph æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ state.py              # çŠ¶æ€å®šä¹‰ï¼ˆState Schemaï¼‰
â”‚   â”‚   â”œâ”€â”€ chatbot_graph.py      # ä¸»å›¾æ„å»ºå’Œç¼–è¯‘
â”‚   â”‚   â”œâ”€â”€ checkpointer.py       # æ£€æŸ¥ç‚¹æŒä¹…åŒ–ç®¡ç†
â”‚   â”‚   â””â”€â”€ graph_builder.py      # å›¾æ„å»ºè¾…åŠ©å‡½æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ nodes/                      # ğŸ“ å›¾èŠ‚ç‚¹å®ç°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ input_handler.py      # è¾“å…¥å¤„ç†å’ŒéªŒè¯èŠ‚ç‚¹
â”‚   â”‚   â”œâ”€â”€ intent_router.py      # æ„å›¾è¯†åˆ«å’Œè·¯ç”±èŠ‚ç‚¹
â”‚   â”‚   â”œâ”€â”€ agent_node.py         # Agent æ¨ç†æ‰§è¡ŒèŠ‚ç‚¹
â”‚   â”‚   â”œâ”€â”€ tool_executor.py      # å·¥å…·è°ƒç”¨æ‰§è¡ŒèŠ‚ç‚¹
â”‚   â”‚   â”œâ”€â”€ response_generator.py # å“åº”ç”Ÿæˆå’Œæ ¼å¼åŒ–èŠ‚ç‚¹
â”‚   â”‚   â””â”€â”€ error_handler.py      # é”™è¯¯å¤„ç†èŠ‚ç‚¹
â”‚   â”‚
â”‚   â”œâ”€â”€ tools/                      # ğŸ› ï¸ å·¥å…·é›†åˆ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py               # å·¥å…·åŸºç±»
â”‚   â”‚   â”œâ”€â”€ search_tool.py        # æœç´¢å·¥å…·ï¼ˆå¦‚ Tavilyï¼‰
â”‚   â”‚   â”œâ”€â”€ calculator_tool.py    # è®¡ç®—å·¥å…·
â”‚   â”‚   â”œâ”€â”€ weather_tool.py       # å¤©æ°”æŸ¥è¯¢å·¥å…·
â”‚   â”‚   â”œâ”€â”€ database_tool.py      # æ•°æ®åº“æŸ¥è¯¢å·¥å…·
â”‚   â”‚   â””â”€â”€ custom_tools.py       # è‡ªå®šä¹‰ä¸šåŠ¡å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ memory/                     # ğŸ§  è®°å¿†ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ conversation_memory.py # çŸ­æœŸå¯¹è¯è®°å¿†
â”‚   â”‚   â”œâ”€â”€ vector_store.py       # å‘é‡å­˜å‚¨ï¼ˆRAGï¼‰
â”‚   â”‚   â””â”€â”€ summary.py            # å¯¹è¯æ‘˜è¦ç”Ÿæˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ storage/                    # ğŸ’¾ å­˜å‚¨å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ redis_client.py       # Redis å®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â”œâ”€â”€ database.py           # æ•°æ®åº“æ“ä½œï¼ˆå¼‚æ­¥ï¼‰
â”‚   â”‚   â”œâ”€â”€ models.py             # ORM æ•°æ®æ¨¡å‹ï¼ˆSQLAlchemyï¼‰
â”‚   â”‚   â””â”€â”€ migrations/           # æ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆAlembicï¼‰
â”‚   â”‚       â”œâ”€â”€ env.py
â”‚   â”‚       â””â”€â”€ versions/
â”‚   â”‚
â”‚   â””â”€â”€ utils/                      # ğŸ”¨ å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ llm_factory.py        # LLM å®¢æˆ·ç«¯å·¥å‚
â”‚       â”œâ”€â”€ logger.py             # æ—¥å¿—é…ç½®å’Œå·¥å…·
â”‚       â”œâ”€â”€ validators.py         # æ•°æ®éªŒè¯å™¨
â”‚       â”œâ”€â”€ formatters.py         # æ ¼å¼åŒ–å·¥å…·
â”‚       â””â”€â”€ retry.py              # é‡è¯•æœºåˆ¶
â”‚
â”œâ”€â”€ tests/                          # ğŸ§ª æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py                # Pytest é…ç½®å’Œ fixtures
â”‚   â”œâ”€â”€ unit/                      # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_graph.py
â”‚   â”‚   â”œâ”€â”€ test_nodes.py
â”‚   â”‚   â”œâ”€â”€ test_tools.py
â”‚   â”‚   â””â”€â”€ test_services.py
â”‚   â”œâ”€â”€ integration/               # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_api.py
â”‚   â”‚   â””â”€â”€ test_chatbot_flow.py
â”‚   â””â”€â”€ fixtures/                  # æµ‹è¯•æ•°æ®
â”‚       â”œâ”€â”€ sample_sessions.json
â”‚       â””â”€â”€ mock_responses.json
â”‚
â”œâ”€â”€ scripts/                        # ğŸ“œ è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ run_dev.py                 # å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ run_chatbot_cli.py         # å‘½ä»¤è¡Œå¯¹è¯ç•Œé¢
â”‚   â”œâ”€â”€ visualize_graph.py         # å›¾ç»“æ„å¯è§†åŒ–
â”‚   â”œâ”€â”€ init_db.py                 # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”œâ”€â”€ migrate_db.py              # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ load_test.py               # è´Ÿè½½æµ‹è¯•è„šæœ¬
â”‚
â”œâ”€â”€ deploy/                         # ğŸš€ éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ Dockerfile                 # Docker é•œåƒæ„å»º
â”‚   â”œâ”€â”€ docker-compose.yml         # æœ¬åœ°/å¼€å‘ç¯å¢ƒç¼–æ’
â”‚   â”œâ”€â”€ docker-compose.prod.yml    # ç”Ÿäº§ç¯å¢ƒç¼–æ’
â”‚   â”œâ”€â”€ nginx.conf                 # Nginx åå‘ä»£ç†é…ç½®
â”‚   â”œâ”€â”€ supervisord.conf           # è¿›ç¨‹ç®¡ç†é…ç½®
â”‚   â””â”€â”€ k8s/                       # Kubernetes é…ç½®ï¼ˆå¯é€‰ï¼‰
â”‚       â”œâ”€â”€ deployment.yaml
â”‚       â”œâ”€â”€ service.yaml
â”‚       â””â”€â”€ ingress.yaml
â”‚
â”œâ”€â”€ data/                           # ğŸ“Š æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ checkpoints/               # LangGraph æ£€æŸ¥ç‚¹å­˜å‚¨
â”‚   â”œâ”€â”€ logs/                      # åº”ç”¨æ—¥å¿—
â”‚   â”œâ”€â”€ cache/                     # ç¼“å­˜æ–‡ä»¶
â”‚   â””â”€â”€ uploads/                   # ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼ˆå¦‚æœ‰ï¼‰
â”‚
â”œâ”€â”€ docs/                           # ğŸ“š æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ architecture.md            # ç³»ç»Ÿæ¶æ„è®¾è®¡
â”‚   â”œâ”€â”€ api_guide.md               # API ä½¿ç”¨æŒ‡å—
â”‚   â”œâ”€â”€ development.md             # å¼€å‘æŒ‡å—
â”‚   â”œâ”€â”€ deployment.md              # éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ è®¾è®¡æ€è·¯.md                 # è®¾è®¡æ€è·¯ï¼ˆä½ ç°æœ‰çš„ï¼‰
â”‚   â””â”€â”€ images/                    # æ–‡æ¡£å›¾ç‰‡èµ„æº
â”‚       â””â”€â”€ architecture.png
â”‚
â””â”€â”€ monitoring/                     # ğŸ“ˆ ç›‘æ§é…ç½®ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ prometheus.yml             # Prometheus é…ç½®
    â”œâ”€â”€ grafana/                   # Grafana ä»ªè¡¨æ¿
    â”‚   â””â”€â”€ dashboards/
    â””â”€â”€ alerts.yml                 # å‘Šè­¦è§„åˆ™
```

## å››ã€æ ¸å¿ƒæµç¨‹è®¾è®¡

### 4.1 çŠ¶æ€å®šä¹‰ï¼ˆState Schemaï¼‰

```python
# src/graph/state.py
class ChatbotState(TypedDict):
    messages: List[BaseMessage]      # æ¶ˆæ¯å†å²
    user_input: str                  # å½“å‰ç”¨æˆ·è¾“å…¥
    intent: Optional[str]            # è¯†åˆ«çš„æ„å›¾
    entities: Dict[str, Any]         # æå–çš„å®ä½“
    tool_calls: List[ToolCall]       # éœ€è¦è°ƒç”¨çš„å·¥å…·
    tool_results: List[Any]          # å·¥å…·æ‰§è¡Œç»“æœ
    response: str                    # æœ€ç»ˆå“åº”
    metadata: Dict[str, Any]         # å…ƒæ•°æ®
```

### 4.2 å›¾æ„å»ºæµç¨‹

```
[START]
   â†“
[è¾“å…¥å¤„ç†] â†’ æ¸…ç†ã€éªŒè¯ç”¨æˆ·è¾“å…¥
   â†“
[æ„å›¾è·¯ç”±] â†’ åˆ¤æ–­ç”¨æˆ·æ„å›¾ï¼ˆé—²èŠ/ä»»åŠ¡/æŸ¥è¯¢ï¼‰
   â†“
   â”œâ”€â†’ [é—²èŠèŠ‚ç‚¹] â†’ ç›´æ¥ç”Ÿæˆå›å¤
   â”œâ”€â†’ [å·¥å…·èŠ‚ç‚¹] â†’ è°ƒç”¨å·¥å…· â†’ [ç»“æœå¤„ç†]
   â””â”€â†’ [AgentèŠ‚ç‚¹] â†’ å¤æ‚æ¨ç† â†’ [å·¥å…·è°ƒç”¨] â†’ [å“åº”ç”Ÿæˆ]
   â†“
[å“åº”ç”Ÿæˆ] â†’ æ ¼å¼åŒ–è¾“å‡º
   â†“
[END]
```

### 4.3 å…³å¥èŠ‚ç‚¹å®ç°æ€è·¯

1. æ„å›¾è·¯ç”±èŠ‚ç‚¹ï¼š

- ä½¿ç”¨ LLM åˆ†ç±»ç”¨æˆ·æ„å›¾
- è¿”å›æ¡ä»¶è¾¹ï¼ˆconditional edgeï¼‰å†³å®šä¸‹ä¸€æ­¥
- æ”¯æŒï¼šé—²èŠã€æŸ¥è¯¢ã€ä»»åŠ¡æ‰§è¡Œã€å¤šè½®å¯¹è¯

2. å·¥å…·æ‰§è¡ŒèŠ‚ç‚¹ï¼š

- æ ¹æ®æ„å›¾é€‰æ‹©åˆé€‚çš„å·¥å…·
- å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå·¥å…·ï¼ˆå¦‚éœ€è¦ï¼‰
- å¤„ç†å·¥å…·æ‰§è¡Œå¼‚å¸¸

3. Agent èŠ‚ç‚¹ï¼š

- ä½¿ç”¨ ReAct æ¨¡å¼ï¼ˆæ¨ç†-è¡ŒåŠ¨-è§‚å¯Ÿï¼‰
- æ”¯æŒå¤šè½®å·¥å…·è°ƒç”¨
- åˆ¤æ–­ä½•æ—¶ç»“æŸå¹¶ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ

## äº”ã€æŠ€æœ¯æ ˆå»ºè®®

1. æ ¸å¿ƒä¾èµ–

- langgraphï¼šå›¾æ„å»ºå’ŒçŠ¶æ€ç®¡ç†
- langchainï¼šLLM é›†æˆå’Œå·¥å…·é“¾
- langchain-openai / langchain-anthropicï¼šLLM æä¾›å•†
- langchain-communityï¼šç¤¾åŒºå·¥å…·

2. API å’ŒæœåŠ¡

- FastAPIï¼šREST API æœåŠ¡
- uvicornï¼šASGI æœåŠ¡å™¨
- pydanticï¼šæ•°æ®éªŒè¯

3. å­˜å‚¨å’Œç¼“å­˜

- redisï¼šä¼šè¯ç¼“å­˜
- sqlite / postgresqlï¼šæ£€æŸ¥ç‚¹æŒä¹…åŒ–
- chromadb / faissï¼šå‘é‡å­˜å‚¨ï¼ˆå¯é€‰ï¼‰

4. å·¥å…·å’Œè°ƒè¯•

- langsmithï¼šå¯è§‚å¯Ÿæ€§å’Œè°ƒè¯•
- streamlitï¼šå¿«é€Ÿ UI åŸå‹ï¼ˆå¯é€‰ï¼‰

## äº”ã€å®ç°æ­¥éª¤å»ºè®®

1. Phase 1ï¼šåŸºç¡€æ¡†æ¶

- æ­å»ºé¡¹ç›®ç»“æ„
- å®ç°ç®€å•çš„çŠ¶æ€å®šä¹‰
- åˆ›å»ºæœ€å°å¯è¿è¡Œçš„å›¾ï¼ˆè¾“å…¥ â†’LLMâ†’ è¾“å‡ºï¼‰
- æ·»åŠ åŸºæœ¬çš„ CLI äº¤äº’

2. Phase 2ï¼šæ ¸å¿ƒåŠŸèƒ½

- å®ç°æ„å›¾è·¯ç”±é€»è¾‘
- é›†æˆ 2-3 ä¸ªåŸºç¡€å·¥å…·
- æ·»åŠ å¯¹è¯è®°å¿†ç®¡ç†
- å®ç°æ£€æŸ¥ç‚¹ä¿å­˜/æ¢å¤

3. Phase 3ï¼šå¢å¼ºåŠŸèƒ½

- å®ç° Agent æ¨ç†èƒ½åŠ›
- æ·»åŠ å¤šè½®å¯¹è¯æ”¯æŒ
- é›†æˆæ›´å¤šå·¥å…·
- ä¼˜åŒ–æç¤ºè¯å’Œè·¯ç”±é€»è¾‘

4. Phase 4ï¼šç”Ÿäº§å°±ç»ª

- æ„å»º REST API
- æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- å®ç°ç›‘æ§å’Œæ—¥å¿—
- æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•
